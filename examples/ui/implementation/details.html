<!--
To change this template, choose Tools | Templates
and open the template in the editor.
-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>

    <title>WEE - Detail</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <link rel="stylesheet" href="static/index.css" type="text/css"/>
    <script src="static/jquery-1.3.2.min.js" type="text/javascript"></script>
    <script src="static/script.js" type="text/javascript"></script>
  </head>
  <body>
    <script type="text/javascript">
        function makeRequest(method, url, success, failure) {
            var req = new XMLHttpRequest();  
            req.open(method, url, true);  
            req.onreadystatechange = function (e) {  
                if (req.readyState === 4) {  
                    if(req.status === 200) {
                        success(req.responseText);
                    } else {  
                        failure("method "+method+" to "+url+" failed");
                    }
                    method
                }  
            };  
            req.send(null);
        }
        function report_failure(text) {
            console.log("ERROR: "+text);
        }

        $.ajax({
          type: "GET",
          url: "remote",
          cache: false,
          success: function(wee_url){
            // getting the instance_state
            console.log("got wee url: "+wee_url+". my path is "+location.pathname);
            makeRequest(
                "GET", (wee_url+location.pathname+"/state/"),
                function(instance_state){
                    console.log("got instance state = "+instance_state);
                    $("#div_state").text(instance_state);
                },report_failure
            );
            // Getting the workflow description
            makeRequest(
                "GET", (wee_url+location.pathname+"/properties/description/"),
                function(instance_description){
                    console.log("got instance_description = "+instance_description);
                    $("#div_description").text(instance_description);
                },report_failure
            );
            // Getting the Context
            makeRequest(
                "GET", (wee_url+location.pathname+"/properties/context/"),
                function(xml){
                    $(xml).find("a").each(function() {
                      var a = $(this);
                      var context_id = a.text;
                      console.log("found context id "+context_id);
                      $.ajax({
                        type: "GET", cache: false,
                        url: (wee_url+location.pathname+"/properties/context/"+context_id),
                        success: function(context_value){
                          console.log("found context value. id="+context_id+", value="+context_value);
                        }
                      });
                    })
                },report_failure
            );

            // Getting the Endpoints
            makeRequest(
                "GET", (wee_url+location.pathname+"/properties/endpoints/"),
                function(xml){
                    $(xml).find("a").each(function() {
                      var a = $(this);
                      var endpoint_id = a.text;
                      console.log("found endpoint id "+endpoint_id);
                      $.ajax({
                        type: "GET", cache: false,
                        url: (wee_url+location.pathname+"/properties/endpoints/"+endpoint_id),
                        success: function(endpoint_value){
                          console.log("found endpoint value. id="+endpoint_id+", value="+endpoint_value);
                        }
                      });
                    })
                },report_failure
            );
          }
        });

        function addContextVariable() {
            var context_id = "id_noxxx";
            var context_value = "value_noxxx";
            makeRequest(
                "POST", (wee_url+location.pathname+"/properties/context?id="+context_id+"&value="+context_value),
                function(){
                    console.log("added context variable: id="+context_id+", value="+context_value);
                },report_failure
            );
        }

    </script>
    <h1>WEE - WICK</h1>
    
    <input type="button" value="Start" name="btn_startstop" id="btn_startstop" onclick="javascript:togglestartstop()"/>

    <form id="frm_userinterface" name="frm_userinterface">
            <table>
                <tr>
                    <td valign="top">Monitor:</td>
                    <td>undefined</td>
                </tr>
                <tr>
                    <td valign="top">Repair: </td>
                    <td>undefined</td>
                </tr>
                <tr>
                    <td valign="top">State: </td>
                    <td><div id="div_state">undefined</div></td>
                </tr>
                <tr>
                    <td valign="top">Context:</td>
                    <td>
                        <a href="javascript:unhide('div_context');">Show/Hide</a>
                        <div id="div_context" class="hidden">
                            <div class="margin-bottom-big margin-top-small">
                                <button id="btn_addcontext" type="button" onclick="javascript:addContext()" title="Contextvariable hinzufügen">
                                    <img class='small' src='static/s/list-add.png' width='16' height='16' alt="Contextvariable hinzufügen" title="Contextvariable hinzufügen"/>
                                </button>
                            </div>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td valign="top">Endpoints:</td>
                    <td>
                        <a href="javascript:unhide('div_endpoints');">Show/Hide</a>
                        <div id="div_endpoints" class="hidden">
                            <div class="margin-bottom-big margin-top-small">
                                <button id="btn_addendpoint" type="button" onclick="javascript:addEndpoint()" title="Endpoint hinzufügen">
                                    <img class='small' src='static/Images/list-add.png' width='16' height='16' alt="Endpoint hinzufügen" title="Endpoint hinzufügen"/>
                                </button>
                            </div>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td valign="top">Description:</td>
                    <td>
                        <a href="javascript:unhide('div_description');">Show/Hide</a>
                        <div id="div_description" class="hidden">
                        </div>
                    </td>
                </tr>
            </table>
            <button id="btn_apply" type="button" onclick="javascript:apply()">Apply to current instance</button>
    </form>
    <h5>WorkflowExecutionEngine - Workflow Information CocKpit</h5>
  </body>




  <div class="invisible" id="add_context">
    <div>
        <button type="button" onclick="$(this).parent().remove()" title="Contextvariable entfernen">
            <img class='small' src='static/Images/list-remove.png' width='16' height='16' alt="Contextvariable entfernen" title="Contextvariable entfernen"/>
        </button>
        <input value="name" type="text" name="context_variable_name"/>
        <input value="value" type="text" name="context_variable_value"/>
    </div>
  </div>
  <div class="invisible" id="add_endpoint">
    <div>
        <button type="button" onclick="$(this).parent().remove()" title="Endpoint entfernen">
            <img class='small' src='static/Images/list-remove.png' width='16' height='16' alt="Endpoint entfernen" title="Endpoint entfernen"/>
        </button>
        <input value="name" type="text" name="endpoint_name"/>
        <input value="url" type="text" name="endpoint_value"/>
    </div>
  </div>


<script type='text/javascript'>//<![CDATA[

var context_i = 0;
if (context_i == 0) addContext();
function addContext() {
    var text = $("#add_context").html();
    console.log("addcontext has some text ... "+text);
    text = text.replace(/context_variable_name/,"context_variable_name_" + context_i);
    text = text.replace(/context_variable_value/,"context_variable_value" + context_i);
    $("#div_context").append(text);
    context_i += 1;
}
var endpoint_i = 0;
if (endpoint_i == 0) addEndpoint();
function addEndpoint() {
    var text = $("#add_endpoint").html();
    console.log("addendpoint has some text ... "+text);
    text = text.replace(/endpoint_name/,"endpoint_name_" + endpoint_i);
    text = text.replace(/endpoint_value/,"endpoint_value" + endpoint_i);
    $("#div_endpoints").append(text);
    endpoint_i += 1;
}

//]]></script>

</html>
