#!/usr/bin/ruby
require '../../../riddl/lib/ruby/client'

srv = Riddl::Client.new("http://localhost:9292/")

# === Generate Wee-Instances
main = srv.resource("/")
status, res = main.request :post => []
status, res = main.request :post => []
status, res = main.request :post => []

# === State check / Start / Stop instance
three = srv.resource("/3/state")
status, res = three.request :get => []
status, res = three.request :put => [ 
  Riddl::Parameter::Simple.new("control","start")
]
status, res = three.request :put => [ 
  Riddl::Parameter::Simple.new("control","stop")
]

# === Context manipulation
three_context = srv.resource("/3/properties/context")
status, res = three_context.request :get => []
status, res = three_context.request :post => [
  Riddl::Parameter::Simple.new("id", "x"), 
  Riddl::Parameter::Simple.new("value", "1")
]
three_context_x = srv.resource("/3/properties/context/x")
sleep(1)
status, res = three_context_x.request :put => [
  Riddl::Parameter::Simple.new("value", "2") 
]
status, res = three_context_x.request :get => []

# === Endpoint manipulation
three_endpoints = srv.resource("/3/properties/endpoints")
status, res = three_endpoints.request :get => []
status, res = three_endpoints.request :post => [
  Riddl::Parameter::Simple.new("id", "endpoint2"), 
  Riddl::Parameter::Simple.new("value", "http://orf.at")
]
three_endpoint_endpoint2 = srv.resource("/3/properties/endpoints/endpoint2")
sleep(1)
status, res = three_endpoint_endpoint2.request :put => [
  Riddl::Parameter::Simple.new("value", "http://orfderneue.at") 
]
status, res = three_endpoint_endpoint2.request :get => []

# === Workflow Description
three_desc = srv.resource("/3/properties/description")
status, res = three_desc.request :get => []
status, res = three_desc.request :put => [
  Riddl::Parameter::Simple.new("description", "activity :a1, :call, endpoint1, 1")
]
